(function(){function w(a,d,c){var b=this;b.x=a;b.y=d;b.z=c;b.F=function(){return new w(b.x,b.y,b.z)};b.set=function(a){b.x=a.x;b.y=a.y;b.z=a.z;return b};b.add=function(a){b.x+=a.x;b.y+=a.y;b.z+=a.z;return b};b.sub=function(a){b.x-=a.x;b.y-=a.y;b.z-=a.z;return b};b.h=function(a){return b.x*a.x+b.y*a.y+b.z*a.z};b.G=function(a){return new w(b.y*a.z-b.z*a.y,b.z*a.x-b.x*a.z,b.x*a.y-b.y*a.x)};b.length=function(){return A(b.x*b.x+b.y*b.y+b.z*b.z)};b.H=function(a){var c=b.x-a.x,d=b.y-a.y,a=b.z-a.z;return A(c*c+d*d+a*a)};b.I=function(a){var c=b.y*a.z-b.z*a.y,d=b.z*a.x-b.x*a.z,q=b.x*a.y-b.y*a.x;return G(A(c*c+d*d+q*q),b.h(a))};b.A=function(a){return Math.acos(b.h(a)/(A(b.x*b.x+b.y*b.y+b.z*b.z)*A(a.x*a.x+a.y*a.y+a.z*a.z)))};b.s=function(){var a=b.length();b.x/=a;b.y/=a;b.z/=a;return b};b.scale=function(a){b.x*=a;b.y*=a;b.z*=a;return b};return b}function H(){var a=this;a.v=function(d,c){for(var b=d.faces,e=new w(0,0,1),p,f,q=F/2,m=0,B=b.length,l;m<B;m++)l=b[m],p=l.vertices,e.A(l.D)+0.15>q&&(r===l.texture?(f=l.color,p="rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+")",a.j(c,d,l,p)):a.j(c,d,l,void 0))};a.j=function(d,c,b,e){var p=c.c,f=b.vertices;if(r===b.texture){d.beginPath();d.moveTo(p[f[0]].x,p[f[0]].y);b=1;for(c=f.length;b<c;b++)d.lineTo(p[f[b]].x,p[f[b]].y);d.closePath();d.fillStyle=e;d.fill()}else{var q=c.textures[b.texture],c=function(a,b,c,f,n,s,u){d.save();d.beginPath();d.moveTo(p[a[0]].x,p[a[0]].y);for(var v=1,o=a.length;v<o;v++)d.lineTo(p[a[v]].x,p[a[v]].y);d.closePath();d.clip();var v=p[a[0]].x,o=p[a[0]].y,h=p[a[1]].x,y=p[a[1]].y,z=p[a[2]].x,a=p[a[2]].y,x=x=1/(b*(u-n)-f*u+s*n+(f-s)*c);d.transform(-(c*(z-h)-n*z+u*h+(n-u)*v)*x,(n*a+c*(y-a)-u*y+(u-n)*o)*x,(b*(z-h)-f*z+s*h+(f-s)*v)*x,-(f*a+b*(y-a)-s*y+(s-f)*o)*x,(b*(u*h-n*z)+c*(f*z-s*h)+(s*n-f*u)*v)*x,(b*(u*y-n*a)+c*(f*a-s*y)+(s*n-f*u)*o)*x);d.drawImage(q,0,0);e&&(d.fillStyle=e,d.fill());d.restore()};c.call(a,f.slice(0,3),0,0,q.width,0,q.width,q.height);4===f.length&&(b=[],b.push(f[2]),b.push(f[3]),b.push(f[0]),c.call(a,b,q.width,q.height,0,q.height,0,0))}};return a}var r=null,o=Math,F=o.PI,h=F/180,C=o.sin,D=o.cos,A=o.sqrt,G=o.atan2,E=o.ceil;window.c3D={Controller:function(a){var d=this;d.fillStyle=r;d.i=[];d.k=[];d.k.solid=new H;d.addObject=function(c){c.w(d,a.width,a.height);d.i.push(c)};d.frame=function(){var c=a.getContext("2d");d.fillStyle!=r?(c.fillStyle=d.fillStyle,c.fillRect(0,0,a.width,a.height)):c.clearRect(0,0,a.width,a.height);d.u(c)};d.r=function(a){return this.k[a]};d.u=function(a){for(var b=d.i,e=0,p=b.length;e<p;e++)b[e].p();b.forEach(function(a){a.a=r});b.sort(function(a,b){r===a.a&&a.e();r===b.a&&b.e();return a.a<b.a?1:-1});a.save();for(e=0,p=b.length;e<p;e++)b[e].q(a);a.restore()};return d},Object:function(){var a=this;a.d=Array(3);for(var d=0;3>d;d++)a.d[d]=Array(3);a.n=Array(6);a.textures=[];a.color=a.points=a.faces=a.c=a.a=a.g=a.f=a.b=r;a.l=a.m=a.scale=0;a.linescale=2;a.drawmode="solid";a.shademode="plain";a.perslevel=512;a.fgamma=a.ftheta=a.fphi=a.fallComplete=r;a.ogamma=a.otheta=a.ophi=a.addgamma=a.addtheta=a.addphi=0;a.init=function(c,b){a.points=c;a.faces=b;a.b=Array(c.length+b.length);for(var e=0,d=a.b.length;e<d;e++)a.b[e]={x:0,y:0,J:0};a.c=Array(c.length);e=0;for(d=a.c.length;e<d;e++)a.c[e]={x:0,y:0};if(0!==a.scale){e=0;for(d=a.points.length;e<d;e++)c[e].x*=a.scale,c[e].y*=a.scale,c[e].z*=a.scale}r===a.color&&(a.color=[255,255,255,1]);a.g=Array(256);for(var e=0,f,q;256>e;e++)d=a.color[0]*(e/255),f=a.color[1]*(e/255),q=a.color[2]*(e/255),a.g[e]="rgba("+E(d)+","+E(f)+","+E(q)+","+a.color[2]+")";for(var e=0,d=b.length,m,B,l,h;e<d;e++)m=b[e].vertices,f=c[m[1]].x-c[m[0]].x,q=c[m[1]].y-c[m[0]].y,B=c[m[1]].z-c[m[0]].z,l=c[m[2]].x-c[m[0]].x,h=c[m[2]].y-c[m[0]].y,m=c[m[2]].z-c[m[0]].z,b[e].t=(new w(q*m-B*h,-(m*f-l*B),f*h-q*l)).s(),b[e].color||(b[e].color=a.color),void 0===b[e].texture&&(b[e].texture=r);return this};a.w=function(c,b,e){a.f=c;b&&(a.l=b/2,a.m=e/2)};a.C=function(){var c,b,e,d=a.points,f=a.b,q=a.faces;c=a.d;for(var m=g=i=j=k=t=0,h=c[0],l=c[1],o=c[2],n=0,s=d.length;n<s;n++)c=d[n].x+m,b=d[n].y+g,e=d[n].z+i,f[n].x=h[0]*c+h[1]*b+h[2]*e+j,f[n].y=l[0]*c+l[1]*b+l[2]*e+k,f[n].z=o[0]*c+o[1]*b+o[2]*e+t;n=0;for(s=q.length;n<s;n++)d=q[n].t,c=d.x,b=d.y,e=d.z,q[n].D=new w(h[0]*c+h[1]*b+h[2]*e,l[0]*c+l[1]*b+l[2]*e,o[0]*c+o[1]*b+o[2]*e)};a.B=function(){for(var c,b,e,d=a.b,f=a.c,h=a.l,m=a.m,o=a.perslevel,l=0,w=a.points.length;l<w;l++)c=d[l].x,b=d[l].y,e=d[l].z+o,0===e&&(e=0.001),f[l].x=c*o/e+h,f[l].y=m-b*o/e};a.p=function(){a.fgamma-5>=a.ogamma&&a.fgamma+5<=a.ogamma&&(a.addgamma=0,a.fgamma=r,a.fallComplete("gamma"));a.ogamma+=a.addgamma;a.ftheta==a.otheta&&(a.addtheta=0,a.ftheta=r,a.fallComplete("theta"));a.otheta+=a.addtheta;a.fphi!=r&&a.fphi-5<=a.ophi&&a.fphi+5>=a.ophi&&(a.addphi=0,a.fphi=r,a.fallComplete("phi"));a.ophi+=a.addphi;a.o();a.C();a.B()};a.q=function(c){a.f.r(a.drawmode).v(a,c)};a.e=function(){for(var c=0,b=a.b,d=0,h=a.points.length;d<h;d++)c+=b[d].z;a.a=c/a.points.length};a.fall=function(c,b,d,h){a["f"+c]=b;a["add"+c]=d;a.fallComplete=h};a.o=function(){var c=a.n,b=a.d;c[0]=C(a.ogamma*h);c[1]=D(a.ogamma*h);c[2]=C(a.otheta*h);c[3]=D(a.otheta*h);c[4]=C(a.ophi*h);c[5]=D(a.ophi*h);b[0][0]=c[5]*c[1];b[1][0]=-(c[5]*c[0]);b[2][0]=c[4];b[0][1]=c[2]*c[4]*c[1]+c[3]*c[0];b[1][1]=c[3]*c[1]-c[2]*c[4]*c[0];b[2][1]=-(c[2]*c[5]);b[0][2]=c[2]*c[0]-c[3]*c[4]*c[1];b[1][2]=c[2]*c[1]+c[3]*c[4]*c[0];b[2][2]=c[3]*c[5]};return a}}})();